<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ETL Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root{
            --bg:#F4F5F7;
            --card:#FFFFFF;
            --text:#1E293B;
            --muted:#64748B;
            --accent:#3B82F6;
            --accent-weak:#60A5FA;
            --divider:#E2E8F0;
            --panel:#F9FAFB;
        }
        html,body{height:100%}
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin:0;
        }
        .container{
            max-width:1200px;
            margin:18px auto;
            padding:18px;
        }

        .header-section{
            background:var(--accent);
            color:#fff;
            padding:22px 18px;
            border-radius:10px;
            box-shadow:0 2px 8px rgba(0,0,0,0.04);
            text-align:center;
        }
        .header-section h1{margin:0;font-size:1.6rem;font-weight:700}
        .header-section p{margin:6px 0 0;color:rgba(255,255,255,0.9)}

        .stats-grid{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
            gap:12px;
            margin-top:18px;
        }
        .stat-card{
            background:var(--card);
            border:1px solid var(--divider);
            border-radius:10px;
            padding:14px;
            text-align:center;
            box-shadow:0 1px 4px rgba(0,0,0,0.02);
        }
        .stat-card h3{font-size:0.9rem;color:var(--accent);margin:0 0 8px}
        .stat-card p{font-weight:700;font-size:1.2rem;margin:0;color:var(--text)}

        .chart-section{
            margin-top:20px;
            background:var(--panel);
            padding:16px;
            border-radius:10px;
            border:1px solid var(--divider);
        }

        .charts-grid{
            display:grid;
            gap:16px;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            align-items:start;
        }

        .chart-card{
            background:var(--card);
            border-radius:10px;
            padding:12px;
            border:1px solid var(--divider);
            box-shadow:0 1px 4px rgba(0,0,0,0.03);
            display:flex;
            flex-direction:column;
        }

        .chart-card h4{
            margin:0 0 10px;
            font-size:1rem;
            color:var(--text);
            text-align:left;
        }

        .chart-canvas-wrap{
            width:100%;
            height:280px;
            display:block;
        }
        .chart-canvas-wrap canvas{
            width:100% !important;
            height:100% !important;
            display:block;
        }

        .chart-country .chart-canvas-wrap{ height:320px }

        .password-grid{
            display:grid;
            grid-template-columns: 380px 1fr;
            gap:20px;
            align-items:start;
        }
        @media (max-width:880px){
            .password-grid{ grid-template-columns: 1fr }
        }

        /* top passwords table style */
        .top-pass-table-wrap{ overflow:auto }
        .top-pass-table{
            width:100%;
            border-collapse:collapse;
            font-size:0.95rem;
        }
        .top-pass-table thead th{
            text-align:left;
            padding:10px 8px;
            font-weight:700;
            color:var(--text);
            border-bottom:1px solid var(--divider);
            background:transparent;
        }
        .top-pass-table tbody td{
            padding:10px 8px;
            border-bottom:1px solid #F1F5F9;
            color:var(--text);
        }
        .top-pass-table .t-idx{ width:40px; text-align:center; color:var(--muted) }
        .top-pass-table .t-pwd{ font-family:monospace; max-width:320px; word-break:break-all; color:#173347 }
        .top-pass-table .t-count{ text-align:center; color:var(--muted) }

        .muted{ color:var(--muted); font-size:0.9rem }
        .footer{ text-align:center; color:var(--muted); margin-top:18px; font-size:0.9rem }

        canvas{ max-width:100% }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>ETL SSHUTTLE</h1>
            <p>Overview of Extracted and Transformed User Data</p>
        </div>

        <div class="tab" style="margin-top:12px;display:flex;gap:8px;justify-content:center">
            <button class="tablinks" onclick="openTab(event,'General')" id="defaultOpen" style="padding:10px 14px;border-radius:8px;border:1px solid var(--divider);background:#fff;cursor:pointer;font-weight:600;color:var(--muted)">General Stats</button>
            <button class="tablinks" onclick="openTab(event,'Password')" style="padding:10px 14px;border-radius:8px;border:1px solid var(--divider);background:#fff;cursor:pointer;font-weight:600;color:var(--muted)">Password Analysis</button>
            <button class="tablinks" onclick="openTab(event,'Downloads')" style="padding:10px 14px;border-radius:8px;border:1px solid var(--divider);background:#fff;cursor:pointer;font-weight:600;color:var(--muted)">File Downloads</button>
        </div>

        <div id="General" class="tabcontent" style="display:none;">
            <h2 style="text-align:center;margin-top:18px">Overall Summary</h2>

            <div class="stats-grid" style="margin-top:12px">
                <div class="stat-card"><h3>Total Users Processed</h3><p>{{TOTAL_USERS}}</p></div>
                <div class="stat-card"><h3>Average Age</h3><p>{{AVG_AGE}}</p></div>
                <div class="stat-card"><h3>Most Frequent Gender</h3><p>{{MOST_FREQUENT_GENDER}}</p></div>
                <div class="stat-card"><h3>Unique Countries</h3><p>{{DIFFERENT_COUNTRIES}}</p></div>
            </div>

            <div class="chart-section">
                <div class="charts-grid" style="margin-top:12px">
                    <div class="chart-card">
                        <h4>Gender Distribution</h4>
                        <div class="chart-canvas-wrap"><canvas id="genderChart"></canvas></div>
                    </div>

                    <div class="chart-card">
                        <h4>Age Decade Distribution</h4>
                        <div class="chart-canvas-wrap"><canvas id="ageChart"></canvas></div>
                    </div>

                    <div class="chart-card">
                        <h4>Timezone Distribution (Top 10)</h4>
                        <div class="chart-canvas-wrap"><canvas id="timezoneChart"></canvas></div>
                    </div>

                    <div class="chart-card chart-country" style="grid-column:1 / -1;">
                        <h4>Users Per Country (Top 10)</h4>
                        <div class="chart-canvas-wrap"><canvas id="countryChart"></canvas></div>
                    </div>

                    <div class="chart-card chart-country" style="grid-column:1 / -1;">
                        <h4>Registrations by Year</h4>
                        <div class="chart-canvas-wrap"><canvas id="regYearChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="Password" class="tabcontent" style="display:none;">
            <h2 style="text-align:center;margin-top:18px">Password Analysis</h2>

            <div class="stats-grid" style="margin-top:12px">
                <div class="stat-card"><h3>Avg Password Length</h3><p>{{AVG_PASSWORD_LENGTH}}</p></div>
                <div class="stat-card"><h3>Birthday in Password</h3><p>{{BIRTHYEAR_IN_PASSWORD}}</p></div>
                <div class="stat-card"><h3>Name in Passwword</h3><p>{{NAME_IN_PASSWORD}}</p></div>
                <div class="stat-card"><h3>Username in Password</h3><p>{{USERNAME_IN_PASSWORD}}</p></div>
                <div class="stat-card"><h3>Strong Passwords</h3><p style="font-size:1.1rem">{{PASSWORD_STRENGTH_SUMMARY}}</p></div>
            </div>

            <div class="chart-section" style="margin-top:16px">
                <div class="password-grid">
                    <div class="chart-card">
                        <h4>Password Complexity</h4>
                        <div class="chart-canvas-wrap"><canvas id="passComplexityChart"></canvas></div>
                    </div>

                    <div class="chart-card" style="padding-bottom:12px;">
                        <h4 style="margin-bottom:8px">Top 10 Passwords</h4>
                        {{TOP_PASSWORDS_TABLE}}
                        <div style="margin-top:18px">
                            <h4 style="margin:6px 0 6px;color:var(--accent);font-size:0.95rem">Most Secure Password Found</h4>
                            <div style="display:inline-block;background:#F1F5F9;padding:10px;border-radius:6px;font-family:monospace;color:#0f172a">{{MOST_SECURE_PASSWORD}}</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top:20px" class="chart-card chart-full">
                    <h4>Password Length Distribution</h4>
                    <div class="chart-canvas-wrap" style="height:360px"><canvas id="passLengthChart"></canvas></div>
                </div>
            </div>
        </div>

        <div id="Downloads" class="tabcontent" style="display:none;">
            <h2 style="text-align:center;margin-top:18px">File Downloads</h2>
            <p style="text-align:center;color:var(--muted)">Download the encrypted source files and the key needed to decrypt them.</p>
            <div style="display:flex;justify-content:center;margin-top:12px">
                <ul style="list-style:none;padding:0;max-width:640px;width:100%">
                    <li style="background:var(--card);border:1px solid var(--divider);padding:12px;border-radius:8px;margin-bottom:8px">
                        <a href="{{VALID_CSV_PATH}}" download style="text-decoration:none;color:var(--accent);font-weight:700">valid_users.csv.enc</a>
                        <div class="muted" style="margin-top:6px">Encrypted valid user data</div>
                    </li>
                    <li style="background:var(--card);border:1px solid var(--divider);padding:12px;border-radius:8px;margin-bottom:8px">
                        <a href="{{INVALID_CSV_PATH}}" download style="text-decoration:none;color:var(--accent);font-weight:700">invalid_users.csv.enc</a>
                        <div class="muted" style="margin-top:6px">Encrypted invalid user data</div>
                    </li>
                    <li style="background:var(--card);border:1px solid var(--divider);padding:12px;border-radius:8px">
                        <a href="{{STATS_JSON_PATH}}" download style="text-decoration:none;color:var(--accent);font-weight:700">statistics.json</a>
                        <div class="muted" style="margin-top:6px">The raw JSON stats file</div>
                    </li>
                </ul>
            </div>
        </div>

        <div class="footer">ETL Dashboard generated on {{TIMESTAMP}}</div>
    </div>

    <script>
        function openTab(evt, tabName){
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for(i=0;i<tabcontent.length;i++){ tabcontent[i].style.display="none"; }
            tablinks = document.getElementsByClassName("tablinks");
            for(i=0;i<tablinks.length;i++){ tablinks[i].classList.remove("active"); tablinks[i].style.borderColor='var(--divider)'; tablinks[i].style.color='var(--muted)'; }
            document.getElementById(tabName).style.display="block";
            evt.currentTarget.classList.add("active");
            evt.currentTarget.style.borderColor='var(--accent)';
            evt.currentTarget.style.color='var(--accent)';
        }

        document.addEventListener("DOMContentLoaded", function(){
            var defaultBtn = document.getElementById("defaultOpen");
            if(defaultBtn) defaultBtn.click();
        });
    </script>

    {{CHART_JS_SCRIPT}}
</body>
</html>