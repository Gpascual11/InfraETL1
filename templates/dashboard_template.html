<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETL Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #F8F8F8;
            color: #333333;
            line-height: 1.6;
        }
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        h1, h2, h3 {
            color: #74B8C1;
            border-bottom: 2px solid #A7C7C6;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .header-section {
            background-color: #B0D0D3;
            color: #333333;
            padding: 30px 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }
        .header-section h1 {
            color: #333333;
            border-bottom: none;
            margin: 0;
        }

        /* --- Tab Styles --- */
        .tab {
            overflow: hidden;
            border-bottom: 2px solid #A7C7C6;
            background-color: #E0EFEB;
            border-radius: 8px 8px 0 0;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 20px;
            transition: 0.3s;
            font-size: 1.1em;
            font-weight: bold;
            color: #555;
        }
        .tab button:hover {
            background-color: #d0e0e0;
        }
        .tab button.active {
            background-color: #B0D0D3;
            color: #333;
            border-bottom: 3px solid #74B8C1;
        }
        .tabcontent {
            display: none;
            padding: 20px 12px;
        }
        /* --- End Tab Styles --- */

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .stat-card {
            background-color: #E0EFEB;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #A7C7C6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            text-align: center;
        }
        .stat-card h3 {
            color: #74B8C1;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: none;
        }
        .stat-card p {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0;
            color: #333333;
        }
        .chart-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #fcfcfc;
            border-radius: 8px;
            border: 1px solid #A7C7C6;
        }
        .chart-container {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px dashed #A7C7C6;
        }
        .chart-container:last-child {
            border-bottom: none;
        }
        .chart-container h3 {
            color: #74B8C1;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* Chart grid for side-by-side charts */
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: center;
        }
        .chart-half {
            max-width: 400px; /* Constrain pie/doughnut charts */
            margin: 0 auto;
        }
        .chart-full {
            width: 100%;
        }

        /* Download Section */
        .download-list {
            list-style: none;
            padding: 0;
        }
        .download-list li {
            background-color: #E0EFEB;
            border: 1px solid #A7C7C6;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 15px;
        }
        .download-list a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
            font-size: 1.1em;
        }
        .download-list a:hover {
            color: #74B8C1;
        }
        .download-list span {
            font-size: 0.9em;
            color: #555;
            margin-left: 10px;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #777;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="header-section">
        <h1>ETL Process Dashboard</h1>
        <p>Overview of Extracted and Transformed User Data</p>
    </div>

    <div class="container">
        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'General')" id="defaultOpen">General Stats</button>
            <button class="tablinks" onclick="openTab(event, 'Password')">Password Analysis</button>
            <button class="tablinks" onclick="openTab(event, 'Downloads')">File Downloads</button>
        </div>

        <div id="General" class="tabcontent">
            <h2>Overall Summary</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Users Processed</h3>
                    <p>{{TOTAL_USERS}}</p>
                </div>
                <div class="stat-card">
                    <h3>Average Age</h3>
                    <p>{{AVG_AGE}}</p>
                </div>
                <div class="stat-card">
                    <h3>Most Frequent Gender</h3>
                    <p>{{MOST_FREQUENT_GENDER}}</p>
                </div>
                <div class="stat-card">
                    <h3>Unique Countries</h3>
                    <p>{{DIFFERENT_COUNTRIES}}</p>
                </div>
            </div>

            <div class="chart-section">
                <div class="chart-grid">
                    <div class="chart-half">
                        <h3>Gender Distribution</h3>
                        <canvas id="genderChart"></canvas>
                    </div>
                    <div class="chart-half">
                        <h3>Age Decade Distribution</h3>
                        <canvas id="ageChart"></canvas>
                    </div>
                </div>

                <div class="chart-container chart-full">
                    <h3>Users Per Country (Top 10)</h3>
                    <canvas id="countryChart"></canvas>
                </div>

                <div class="chart-container chart-full">
                    <h3>Email Domains (Top 10)</h3>
                    <canvas id="emailChart"></canvas>
                </div>

                <div class="chart-container chart-full">
                    <h3>Registrations by Year</h3>
                    <canvas id="regYearChart"></canvas>
                </div>
                <div class="chart-container chart-full">
                    <h3>Timezone Distribution (Top 10)</h3>
                    <canvas id="timezoneChart"></canvas>
                </div>
                </div>
        </div>

        <div id="Password" class="tabcontent">
            <h2>Password Analysis</h2>
            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                <div class="stat-card">
                    <h3>Avg Password Length</h3>
                    <p>{{AVG_PASSWORD_LENGTH}}</p>
                </div>
                <div class="stat-card">
                    <h3>Strong Passwords</h3>
                    <p style="font-size: 1.3em;">{{PASSWORD_STRENGTH_SUMMARY}}</p>
                </div>
                <div class="stat-card">
                    <h3>Name in Password</h3>
                    <p>{{NAME_IN_PASSWORD}}</p>
                </div>
                <div class="stat-card">
                    <h3>Birth Year in Password</h3>
                    <p>{{BIRTHYEAR_IN_PASSWORD}}</p>
                </div>
                <div class="stat-card">
                    <h3>Username in Password</h3>
                    <p>{{USERNAME_IN_PASSWORD}}</p>
                </div>
                </div>

            <div class="chart-section">
                <div class="chart-grid">
                    <div class="chart-half">
                        <h3>Password Complexity</h3>
                        <canvas id="passComplexityChart"></canvas>
                    </div>
                    <div class="chart-container chart-half">
                        <h3>Top 10 Passwords</h3>
                        <pre id="top-passwords-pre" style="text-align: left; padding: 10px;">{{TOP_PASSWORDS_TABLE}}</pre>
                    </div>
                </div>

                <div class="chart-container chart-full">
                    <h3>Password Length Distribution</h3>
                    <canvas id="passLengthChart"></canvas>
                </div>

            </div>
        </div>

        <div id="Downloads" class="tabcontent">
            <h2>File Downloads</h2>
            <p>Download the encrypted source files and the key needed to decrypt them.</p>
            <ul class="download-list">
                <li>
                    <a href="{{VALID_CSV_PATH}}" download>valid_users.csv.enc</a>
                    <span>(Encrypted valid user data)</span>
                </li>
                <li>
                    <a href="{{INVALID_CSV_PATH}}" download>invalid_users.csv.enc</a>
                    <span>(Encrypted invalid user data)</span>
                </li>
                <li>
                    <a href="{{STATS_JSON_PATH}}" download>statistics.json</a>
                    <span>(The raw JSON stats file)</span>
                </li>
            </ul>
        </div>

        <div class="footer">
            <p>ETL Dashboard generated on {{TIMESTAMP}}</p>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("General").style.display = "block";
            var defaultButton = document.getElementById("defaultOpen");
            if (defaultButton) {
                defaultButton.className += " active";
            }
        });
    </script>

    {{CHART_JS_SCRIPT}}

</body>
</html>